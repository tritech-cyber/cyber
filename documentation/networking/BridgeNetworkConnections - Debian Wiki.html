<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0048)https://wiki.debian.org/BridgeNetworkConnections -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="https://wiki.debian.org/htdocs/favicon.ico">
<script type="text/javascript" src="./BridgeNetworkConnections - Debian Wiki_files/bugstatus.js"></script>

<meta name="robots" content="index,nofollow">

<title>BridgeNetworkConnections - Debian Wiki</title>
<script type="text/javascript" src="./BridgeNetworkConnections - Debian Wiki_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="./BridgeNetworkConnections - Debian Wiki_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="./BridgeNetworkConnections - Debian Wiki_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="./BridgeNetworkConnections - Debian Wiki_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="./BridgeNetworkConnections - Debian Wiki_files/projection.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="./BridgeNetworkConnections - Debian Wiki_files/debian-wiki-1.0.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/htdocs/debwiki/css/msie.css">
<![endif]-->


<link rel="alternate" title="Debian Wiki: BridgeNetworkConnections" href="https://wiki.debian.org/BridgeNetworkConnections?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=BridgeNetworkConnections&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="https://wiki.debian.org/FrontPage">
<link rel="Alternate" title="Wiki Markup" href="https://wiki.debian.org/BridgeNetworkConnections?action=raw">
<link rel="Alternate" media="print" title="Print View" href="https://wiki.debian.org/BridgeNetworkConnections?action=print">
<link rel="Search" href="https://wiki.debian.org/FindPage">
<link rel="Index" href="https://wiki.debian.org/TitleIndex">
<link rel="Glossary" href="https://wiki.debian.org/WordIndex">
<link rel="Help" href="https://wiki.debian.org/HelpOnFormatting">
</head>

<body lang="en" dir="ltr">
<div id="logo"><a href="https://www.debian.org/" title="Debian Homepage"><img src="./BridgeNetworkConnections - Debian Wiki_files/openlogo-50.png" alt="Debian" width="50" height="61"></a></div>
<div id="header">
<div id="wikisection">
<p class="section"><a href="https://wiki.debian.org/FrontPage" title="Debian Wiki Homepage">Wiki</a></p>
<div id="username"><a href="https://wiki.debian.org/BridgeNetworkConnections?action=login" id="login" rel="nofollow">Login</a></div>
</div>
<div id="navbar">

<ul id="navibar">
<li class="wikilink"><a href="https://wiki.debian.org/FrontPage">FrontPage</a></li><li class="wikilink"><a href="https://wiki.debian.org/RecentChanges">RecentChanges</a></li><li class="wikilink"><a href="https://wiki.debian.org/FindPage">FindPage</a></li><li class="wikilink"><a href="https://wiki.debian.org/HelpContents">HelpContents</a></li><li class="current"><a href="https://wiki.debian.org/BridgeNetworkConnections">BridgeNetworkConnections</a></li>
</ul>

</div>

<form id="searchform" method="get" action="https://wiki.debian.org/BridgeNetworkConnections">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput" style="display: none;">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20" onfocus="searchFocus(this)" onblur="searchBlur(this)" onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search" class="disabled">
<input id="titlesearch" name="titlesearch" type="submit" value="Titles" alt="Search Titles" disabled="">
<input id="fullsearch" name="fullsearch" type="submit" value="Text" alt="Search Full Text" disabled="">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="https://www.debian.org/" title="Debian Homepage"><img src="./BridgeNetworkConnections - Debian Wiki_files/openlogo-50.png" alt="Debian" width="50" height="61"></a></div>

<div id="breadcrumbs"><a href="https://wiki.debian.org/FrontPage" title="Debian Wiki Homepage">Wiki</a><span class="sep">/</span>

</div>

<ul class="editbar"><li><a href="https://wiki.debian.org/BridgeNetworkConnections?action=login" id="login-1" rel="nofollow">Login</a></li><li class="toggleCommentsButton" style="display:none;"><a href="https://wiki.debian.org/BridgeNetworkConnections#" class="nbcomment" onclick="toggleComments();return false;">Comments</a></li><li><a class="nbinfo" href="https://wiki.debian.org/BridgeNetworkConnections?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="https://wiki.debian.org/BridgeNetworkConnections?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="https://wiki.debian.org/BridgeNetworkConnections">
<div>
    
    <select name="action" onchange="if ((this.selectedIndex != 0) &amp;&amp;
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show">More Actions:</option><option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="RenderAsDocbook">Render as Docbook</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled="" class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled="" class="disabled">------------------------</option>
<option value="RenamePage" disabled="" class="disabled">Rename Page</option>
<option value="DeletePage" disabled="" class="disabled">Delete Page</option>
<option value="show" disabled="" class="disabled">------------------------</option>
<option value="show" disabled="" class="disabled">Subscribe User</option>
<option value="show" disabled="" class="disabled">------------------------</option>
<option value="show" disabled="" class="disabled">Remove Spam</option>
<option value="show" disabled="" class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="show" disabled="" class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<h1 id="locationline">


<ul id="pagelocation">
<li><a href="https://wiki.debian.org/BridgeNetworkConnections">BridgeNetworkConnections</a></li>
</ul>

</h1>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><p class="line867"><small><a href="https://wiki.debian.org/DebianWiki/EditorGuide#translation">Translation(s)</a>: English - <a href="https://wiki.debian.org/fr/BridgeNetworkConnections">Fran√ßais</a> </small> <span class="anchor" id="line-3"></span></p><hr><p class="line874"> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span></p><p class="line867">
</p><h1 id="Bridging_Network_Connections">Bridging Network Connections</h1>
<span class="anchor" id="line-6"></span><p class="line867"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Bridging_Network_Connections">Bridging Network Connections</a><ol><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Introduction">Introduction</a></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Installing_the_software">Installing the software</a></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Setting_up_your_Bridge">Setting up your Bridge</a><ol><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Manual_bridge_setup">Manual bridge setup</a></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Configuring_bridging_in_.2Fetc.2Fnetwork.2Finterfaces">Configuring bridging in /etc/network/interfaces</a><ol><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Useful_options_for_virtualised_environments">Useful options for virtualised environments</a></li></ol></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Setting_up_bridge-related_kernel_variables">Setting up bridge-related kernel variables</a></li></ol></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Libvirt_and_bridging">Libvirt and bridging</a></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Bridging_with_a_wireless_NIC">Bridging with a wireless NIC</a><ol><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#ebtables_Overview">ebtables Overview</a></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#bridge-utils_Modifications">bridge-utils Modifications</a></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Setting_up_the_rules">Setting up the rules</a></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Saving_your_rules">Saving your rules</a></li></ol></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#Link_Aggregation_.28LACP.29_with_VLANs">Link Aggregation (LACP) with VLANs</a></li><li>
<a href="https://wiki.debian.org/BridgeNetworkConnections#More_information">More information</a></li></ol></li></ol></div> <span class="anchor" id="line-7"></span>
<h2 id="Introduction">Introduction</h2>
<span class="anchor" id="line-8"></span><p class="line874">Bridging your network connection is a handy method for sharing your internet connection between two (or more) computers.  It‚Äôs useful if you can‚Äôt buy a router with more than one ethernet port, or if you‚Äôre a college student in a dorm room with limited ethernet jacks and no router. <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span></p><p class="line874">Basically, bridging is plugging one computer into another computer that already has a connection to a larger network (like the internet) and letting the bridged computer use the networked computer‚Äôs connection.  To do so though, the networked computer needs to have two ethernet ports, one for the big network, and one for the bridged computer.  Make sure before starting that the computer you‚Äôre going to bridge through has two ethernet ports, and that the hardware is capable of bridging ethernet connections (it probably should be). <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span></p><p class="line874">Another example scenario for using bridging is to provide redundant networking capabilities. For example using two network interfaces to connect to two spanning tree enabled switches provides a redundant connection in the event of a cable, interface or switch failure. This requires spanning tree to be enabled on both the bridge interface and the switch. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span></p><p class="line867">
</p><h2 id="Installing_the_software">Installing the software</h2>
<span class="anchor" id="line-15"></span><p class="line862">The program you‚Äôre going to need is called <tt class="backtick">brctl</tt> and is included in <a class="interwiki" href="https://packages.debian.org/bridge-utils" title="DebianPkg">bridge-utils</a>.  Find it in Synaptic, or install it using this command: <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span></p><pre><span class="anchor" id="line-1"></span> # aptitude install bridge-utils</pre><span class="anchor" id="line-19"></span><p class="line862">This software allows you to set up and use the bridge interface.  The bridge interface appears as a new interface in <tt class="backtick">ip&nbsp;link</tt>, much like <tt class="backtick">eth0</tt> or <tt class="backtick">eth1</tt>.  It doesn‚Äôt physically exist on your computer, but instead it is a virtual interface that just takes the packets from one physical interface, and transparently routes them to the other. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span></p><p class="line867">
</p><h2 id="Setting_up_your_Bridge">Setting up your Bridge</h2>
<span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
</p><h3 id="Manual_bridge_setup">Manual bridge setup</h3>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line867"><strong>Note:</strong> All these commands are to be issued on the computer with the existing network connection.  To set up the computer that‚Äôs going to be bridged, just set it up normally, as you would any other computer.  You CAN use DHCP, or you can use a static address.  It doesn‚Äôt matter. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></p><p class="line867"><strong>Note:</strong> If, after trying to use the bridge interface, you find your network link becomes dead and refuses to work again, it might be that the router/switch upstream is blocking "unauthorized switches" in the network (for example, by detecting BPDU packets).  You'll have to change its configuration to explicitly allow the host machine/network port as a "switch". <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span></p><p class="line874">First step to creating the bridge network is actually creating it.  Issue this command to get the ball rolling and create the new interface. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span></p><pre><span class="anchor" id="line-1-1"></span> # brctl addbr br0</pre><span class="anchor" id="line-33"></span><p class="line862">The name <tt class="backtick">br0</tt> is up to you and can be anything you want. Now you need to add the interfaces that are going to be bridged. You can cross-check the enumeration of your ethernet devices with (<tt class="backtick">eth0</tt>, <tt class="backtick">eth1</tt>, etc. is common): <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span></p><pre><span class="anchor" id="line-1-2"></span> # ip addr show</pre><span class="anchor" id="line-37"></span><p class="line862">Add both the interface with the second computer, and the interface that leads to the existing network. Use <tt class="backtick">brctl</tt>: <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span></p><pre><span class="anchor" id="line-1-3"></span> # brctl addif br0 eth0 eth1</pre><span class="anchor" id="line-41"></span><p class="line862">This will add the two interfaces <tt class="backtick">eth0</tt> and <tt class="backtick">eth1</tt> to bridge <tt class="backtick">br0</tt>.  Simple enough.  There‚Äôs no distinction with how you add the bridges, or what order you do it, or any special commands you have to add to distinguish them.  So don‚Äôt worry about that. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span></p><p class="line874">Well, now we have our bridges, so bring all the interfaces up, and you‚Äôll be set! <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span></p><p class="line867">
</p><h3 id="Configuring_bridging_in_.2Fetc.2Fnetwork.2Finterfaces">Configuring bridging in /etc/network/interfaces</h3>
<span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line862">To make your bridge a little more permanent, you will need to edit <tt class="backtick">/etc/network/interfaces</tt>.  Using our example names, make it look like this and you‚Äôre set (if you want to use DHCP): <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span></p><pre><span class="anchor" id="line-1-4"></span> # This file describes the network interfaces available on your system
<span class="anchor" id="line-2"></span> # and how to activate them. For more information, see interfaces(5).
<span class="anchor" id="line-3"></span>
<span class="anchor" id="line-4"></span> # The loopback network interface
<span class="anchor" id="line-5"></span> auto lo
<span class="anchor" id="line-6"></span> iface lo inet loopback
<span class="anchor" id="line-7"></span>
<span class="anchor" id="line-8"></span> # Set up interfaces manually, avoiding conflicts with, e.g., network manager
<span class="anchor" id="line-9"></span> iface eth0 inet manual
<span class="anchor" id="line-10"></span>
<span class="anchor" id="line-11"></span> iface eth1 inet manual
<span class="anchor" id="line-12"></span>
<span class="anchor" id="line-13"></span> # Bridge setup
<span class="anchor" id="line-14"></span> iface br0 inet dhcp
<span class="anchor" id="line-15"></span>    bridge_ports eth0 eth1</pre><span class="anchor" id="line-65"></span><p class="line862">To bring up your bridge, you just have to issue <tt>&nbsp;#&nbsp;ifup&nbsp;br0</tt> and it‚Äôll bring up the other necessary interfaces without anything in your <tt>interfaces</tt> file about the bridged interfaces. <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span></p><p class="line862">If you like static IP‚Äôs, then you can just add the static IP options under the <tt class="backtick">br0</tt> interface setup. For example: <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span></p><pre><span class="anchor" id="line-1-5"></span> # This file describes the network interfaces available on your system
<span class="anchor" id="line-2-1"></span> # and how to activate them. For more information, see interfaces(5).
<span class="anchor" id="line-3-1"></span>
<span class="anchor" id="line-4-1"></span> # The loopback network interface
<span class="anchor" id="line-5-1"></span> auto lo br0
<span class="anchor" id="line-6-1"></span> iface lo inet loopback
<span class="anchor" id="line-7-1"></span>
<span class="anchor" id="line-8-1"></span> # Set up interfaces manually, avoiding conflicts with, e.g., network manager
<span class="anchor" id="line-9-1"></span> iface eth0 inet manual
<span class="anchor" id="line-10-1"></span>
<span class="anchor" id="line-11-1"></span> iface eth1 inet manual
<span class="anchor" id="line-12-1"></span>
<span class="anchor" id="line-13-1"></span> # Bridge setup
<span class="anchor" id="line-14-1"></span> iface br0 inet static
<span class="anchor" id="line-15-1"></span>    bridge_ports eth0 eth1
<span class="anchor" id="line-16"></span>        address 192.168.1.2
<span class="anchor" id="line-17"></span>        broadcast 192.168.1.255
<span class="anchor" id="line-18"></span>        netmask 255.255.255.0
<span class="anchor" id="line-19"></span>        gateway 192.168.1.1</pre><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line867">
</p><h4 id="Useful_options_for_virtualised_environments">Useful options for virtualised environments</h4>
<span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line874">Some other useful options to use in any stanza in a virtualised environment are: <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span></p><pre><span class="anchor" id="line-1-6"></span>        bridge_stp off       # disable Spanning Tree Protocol
<span class="anchor" id="line-2-2"></span>        bridge_waitport 0    # no delay before a port becomes available
<span class="anchor" id="line-3-2"></span>        bridge_fd 0          # no forwarding delay
<span class="anchor" id="line-4-2"></span>        bridge_ports none    # if you do not want to bind to any ports
<span class="anchor" id="line-5-2"></span>        bridge_ports regex eth* # use a regular expression to define ports</pre><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><p class="line867">
</p><h3 id="Setting_up_bridge-related_kernel_variables">Setting up bridge-related kernel variables</h3>
<span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><p class="line862">There are several kernel variables that affect bridge operation. In <a class="http" href="http://wiki.libvirt.org/page/Networking">some cases</a> you may need to tweak these variables. There are two common options: <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span></p><ul><li><p class="line862">Add variables to <em>/etc/sysctl.conf</em> directly <span class="anchor" id="line-106"></span></p></li><li><p class="line862">Put them to a sysctl configuration file fragment (e.g. <em>/etc/sysctl.d/bridge_local.conf</em>) <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span></p></li></ul><p class="line862">In the latter case, the <em>procps</em> init script <em>should</em> take care of loading them during boot. However, on Squeeze it does not, and you need to restart it from <em>/etc/rc.local</em> (or similar): <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span></p><p class="line867"><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span></p><pre><span class="anchor" id="line-1-7"></span># /etc/rc.local
<span class="anchor" id="line-2-3"></span>
<span class="anchor" id="line-3-3"></span># Load kernel variables from /etc/sysctl.d
<span class="anchor" id="line-4-3"></span>/etc/init.d/procps restart
<span class="anchor" id="line-5-3"></span>
<span class="anchor" id="line-6-2"></span>exit 0</pre><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867">
</p><h2 id="Libvirt_and_bridging">Libvirt and bridging</h2>
<span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line867"><a class="http" href="http://libvirt.org/index.html">Libvirt</a> is a virtualization API that supports KVM (and various other virtualization technologies). It's often desirable to <a class="http" href="http://wiki.libvirt.org/page/Networking#Bridged_networking_.28aka_.22shared_physical_device.22.29">share a physical network interface with guests</a> by creating a bridge. This usually offers excellent performance and doesn't require NAT. This operation is composed of two parts: <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span></p><ul><li><p class="line862">Setup the bridge interface on host as described in this article, <a class="http" href="http://wiki.libvirt.org/page/Networking#Altering_the_interface_config">here</a> or <a class="https" href="https://jamielinux.com/docs/libvirt-networking-handbook/bridged-network.html">here</a> <span class="anchor" id="line-124"></span></p></li><li>Configure guest to use the newly-created bridge <span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span></li></ul><p class="line862">The <a class="https" href="https://jamielinux.com/docs/libvirt-networking-handbook/">libvirt Networking Handbook</a> provides thorough instructions. <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span></p><p class="line862">You can verify if bridging is working properly by looking at <em>brctl</em> output: <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span></p><p class="line867"><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span></p><pre><span class="anchor" id="line-1-8"></span>root@server:/etc/libvirt/qemu# brctl show
<span class="anchor" id="line-2-4"></span>bridge name     bridge id               STP enabled     interfaces
<span class="anchor" id="line-3-4"></span>br0             8000.001ec952d26b       yes             eth0
<span class="anchor" id="line-4-4"></span>                                                        vnet0
<span class="anchor" id="line-5-4"></span>                                                        vnet1
<span class="anchor" id="line-6-3"></span>                                                        vnet2
<span class="anchor" id="line-7-2"></span>virbr0          8000.000000000000       yes</pre><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line862">As can be seen, guest network interfaces <em>vnet0</em>, <em>vnet1</em> and <em>vnet2</em> are bound with the physical interface <em>eth0</em> in the bridge <em>br0</em>. The <em>virbr0</em> interface is only used by libvirt to give guests NAT connectivity. <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span></p><p class="line867">
</p><h2 id="Bridging_with_a_wireless_NIC">Bridging with a wireless NIC</h2>
<span class="anchor" id="line-143"></span><p class="line862">Just like you can bridge two wired ethernet interfaces, you can bridge between an ethernet interface and a wireless interface. However, most Access Points (APs) will reject frames that have a source address that didn‚Äôt authenticate with the AP. Since Linux does ethernet bridging transparently (doesn‚Äôt modify outgoing or incoming frames), we have to set up some rules to do this with a program called <a class="interwiki" href="https://packages.debian.org/ebtables" title="DebianPkg">ebtables</a>. <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span></p><p class="line862">For an alternative Layer 3 approach using proxy ARP and routing, see <a href="https://wiki.debian.org/BridgeNetworkConnectionsProxyArp">BridgeNetworkConnectionsProxyArp</a>. <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span></p><p class="line867">
</p><h3 id="ebtables_Overview">ebtables Overview</h3>
<span class="anchor" id="line-148"></span><p class="line862">ebtables is essentially like <a class="interwiki" href="https://packages.debian.org/iptables" title="DebianPkg">iptables</a>, except it operates on the MAC sublayer of the data-link layer of the OSI model, instead of the network layer. In our case, this allows to change the source MAC address of all of our frames. This is handy because we fool our AP into thinking that all of our forwarded frames come from the machine which authenticated to the AP. <span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span></p><p class="line867">
</p><h3 id="bridge-utils_Modifications">bridge-utils Modifications</h3>
<span class="anchor" id="line-151"></span><p class="line862">Before this will work, you need to modify your <tt class="backtick">/etc/network/interfaces</tt> file, and add this line to your bridge stanza: <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span></p><pre><span class="anchor" id="line-1-9"></span> pre-up iwconfig wlan0 essid $YOUR_ESSID
<span class="anchor" id="line-2-5"></span> bridge_hw $MAC_ADDRESS_OF_YOUR_WIRELESS_CARD</pre><span class="anchor" id="line-156"></span><p class="line862">Obviously replacing <tt class="backtick">$MAC_ADDRESS_OF_YOUR_WIRELESS_CARD</tt> with the actual MAC address of your wireless card, and <tt class="backtick">$YOUR_ESSID</tt> as the ESSID of your wireless network. If you don‚Äôt know your MAC address, you can find it by typing <span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span></p><pre><span class="anchor" id="line-1-10"></span> # ip link show wlan0</pre><span class="anchor" id="line-160"></span><p class="line862">Where <tt class="backtick">wlan0</tt> is your wireless interface. Your MAC address is listed as the HWaddr. <span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span></p><p class="line867">
</p><h3 id="Setting_up_the_rules">Setting up the rules</h3>
<span class="anchor" id="line-163"></span><p class="line874">First, install ebtables: <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span></p><pre><span class="anchor" id="line-1-11"></span> # aptitude install ebtables</pre><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><p class="line874">Now we can start setting up the rules. The syntax for ebtables is almost identical to that of iptables, so if you have experience with iptables, this will look pretty familiar to you. <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span></p><p class="line874">The first rule we‚Äôre going to set up will set the source MAC address to the MAC address of the bridge for all frames sent to the AP. <span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span></p><p class="line867"><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span></p><pre><span class="anchor" id="line-1-12"></span> # ebtables -t nat -A POSTROUTING -o wlan0 -j snat --to-src $MAC_OF_BRIDGE --snat-arp --snat-target ACCEPT</pre><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line874">The next rules will require you to know the MAC and IP of each of the machines behind your bridge. Replace $MAC and $IP with these. <span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span></p><pre><span class="anchor" id="line-1-13"></span> # ebtables -t nat -A PREROUTING -p IPv4 -i wlan0 --ip-dst $IP -j dnat --to-dst $MAC --dnat-target ACCEPT
<span class="anchor" id="line-2-6"></span> # ebtables -t nat -A PREROUTING -p ARP -i wlan0 --arp-ip-dst $IP -j dnat --to-dst $MAC --dnat-target ACCEPT</pre><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><p class="line874">This is tedious to have to type in everytime you add a new computer to a switch behind your bridge, so I wrote a script to do it for you <span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-1-1"></span></p><div class="highlight bash"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-3c042f810abbef691cff5bd6556a81bd492a8452\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="https://wiki.debian.org/BridgeNetworkConnections#" onclick="return togglenumber(&#39;CA-3c042f810abbef691cff5bd6556a81bd492a8452&#39;, 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452" lang="en"><span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_1">   1</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_1"></span><span class="anchor" id="line-1-2"></span> <span class="Comment">#!/bin/bash</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_2">   2</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_2"></span><span class="anchor" id="line-2-1"></span><span class="Comment"></span> <span class="Comment"># addcomputer</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_3">   3</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_3"></span><span class="anchor" id="line-3-1"></span><span class="Comment"></span> <span class="Comment"># Will Orr - 2009</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_4">   4</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_4"></span><span class="anchor" id="line-4-1"></span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_5">   5</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_5"></span><span class="anchor" id="line-5-1"></span> <span class="ID">INIF</span>=<span class="String">"wlan0"</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_6">   6</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_6"></span><span class="anchor" id="line-6-1"></span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_7">   7</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_7"></span><span class="anchor" id="line-7-1"></span> <span class="ResWord">function</span> add_ebtables () {</span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_8">   8</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_8"></span><span class="anchor" id="line-8-1"></span>   <span class="ID">COMPIP</span>=<span class="ID">$1</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_9">   9</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_9"></span><span class="anchor" id="line-9-1"></span>   <span class="ID">COMPMAC</span>=<span class="ID">$2</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_10">  10</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_10"></span><span class="anchor" id="line-10-1"></span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_11">  11</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_11"></span><span class="anchor" id="line-11-1"></span>   ebtables -t nat -A PREROUTING -i <span class="ID">$INIF</span> -p IPv4 --ip-dst <span class="ID">$COMPIP</span> -j <span class="SPChar">\</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_12">  12</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_12"></span><span class="anchor" id="line-12-1"></span><span class="SPChar"></span>   dnat --to-dst <span class="ID">$COMPMAC</span> --dnat-target ACCEPT</span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_13">  13</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_13"></span><span class="anchor" id="line-13-1"></span>   ebtables -t nat -A PREROUTING -i <span class="ID">$INIF</span> -p ARP --arp-ip-dst <span class="ID">$COMPIP</span> <span class="SPChar">\</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_14">  14</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_14"></span><span class="anchor" id="line-14-1"></span><span class="SPChar"></span>   -j dnat --to-dst <span class="ID">$COMPMAC</span> --dnat-target ACCEPT</span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_15">  15</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_15"></span><span class="anchor" id="line-15-1"></span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_16">  16</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_16"></span><span class="anchor" id="line-16-1"></span> }</span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_17">  17</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_17"></span><span class="anchor" id="line-17-1"></span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_18">  18</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_18"></span><span class="anchor" id="line-18-1"></span> <span class="ResWord">if</span> [[ <span class="ID">$#</span> -ne <span class="Number">2</span> ]]; <span class="ResWord">then</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_19">  19</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_19"></span><span class="anchor" id="line-19-1"></span>   <span class="ResWord">echo</span> <span class="String">"</span><span class="String">Usage: </span><span class="ID">$0</span><span class="String"> ip mac</span><span class="String">"</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_20">  20</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_20"></span><span class="anchor" id="line-20-1"></span> <span class="ResWord">elif</span> [[ <span class="ResWord">$(</span>whoami<span class="ResWord">)</span> != <span class="String">"root"</span> ]]; <span class="ResWord">then</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_21">  21</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_21"></span><span class="anchor" id="line-21-1"></span>   <span class="ResWord">echo</span> <span class="String">"Error: must be root"</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_22">  22</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_22"></span><span class="anchor" id="line-22-1"></span> <span class="ResWord">else</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_23">  23</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_23"></span><span class="anchor" id="line-23-1"></span>   add_ebtables <span class="ID">$1</span> <span class="ID">$2</span></span>
<span class="line"><span class="LineNumber"><a href="https://wiki.debian.org/BridgeNetworkConnections#CA-3c042f810abbef691cff5bd6556a81bd492a8452_24">  24</a> </span><span class="LineAnchor" id="CA-3c042f810abbef691cff5bd6556a81bd492a8452_24"></span><span class="anchor" id="line-24-1"></span> <span class="ResWord">fi</span></span>
</pre></div></div><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line867">
</p><h3 id="Saving_your_rules">Saving your rules</h3>
<span class="anchor" id="line-212"></span><p class="line874">After you have written your ebtables rules, you need to save them in an atomic file. Otherwise, your rules will not be preserved. Saving them is rather simple though. <span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span></p><pre><span class="anchor" id="line-1-14"></span> # EBTABLES_ATOMIC_FILE=/root/ebtables-atomic ebtables -t nat --atomic-save</pre><span class="anchor" id="line-216"></span><p class="line874">And then load them like this: <span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span></p><pre><span class="anchor" id="line-1-15"></span> # EBTABLES_ATOMIC_FILE=/root/ebtables-atomic ebtables -t nat --atomic-commit</pre><span class="anchor" id="line-220"></span><p class="line862">If you want to load your ebtables rules at boot time, a handy place to stick the commit command is in /etc/rc.local. Just pop it in there before the <tt>exit&nbsp;0</tt> line. <span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span></p><p class="line867">
</p><h2 id="Link_Aggregation_.28LACP.29_with_VLANs">Link Aggregation (LACP) with VLANs</h2>
<span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><p class="line862">Here is an example of the <tt>/etc/network/interfaces</tt> file for 2 interfaces LACP bonded together with VLANs defined on top of the bond. <span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span></p><p class="line874">Notes: Tested on Debian Jessie 8.0 rc1 on 3/11/2015 (AMD64 arch) <span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span></p><p class="line874">Required debian packages for vlan and bonding: <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span></p><p class="line867"><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span></p><pre><span class="anchor" id="line-1-16"></span>aptitude install vlan ifenslave
<span class="anchor" id="line-2-7"></span>echo "8021q" &gt;&gt; /etc/modules</pre><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><p class="line862">The <tt>/etc/network/interfaces</tt> could be: <span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span></p><pre><span class="anchor" id="line-1-17"></span>auto lo
<span class="anchor" id="line-2-8"></span>iface lo inet loopback
<span class="anchor" id="line-3-5"></span># there is one other thing I am forgetting here... see bonding setup above
<span class="anchor" id="line-4-5"></span>
<span class="anchor" id="line-5-5"></span>###### Bonded 10Gig setup - LACP Aggregation #######  bond eth4 and eth5
<span class="anchor" id="line-6-4"></span>#### (set up from switch as trunk links with LACP)  then split out VLANS
<span class="anchor" id="line-7-3"></span>
<span class="anchor" id="line-8-2"></span>## View status with:   cat /proc/net/bonding/bond0
<span class="anchor" id="line-9-2"></span>
<span class="anchor" id="line-10-2"></span>auto bond0
<span class="anchor" id="line-11-2"></span>iface bond0 inet manual
<span class="anchor" id="line-12-2"></span>        up ifconfig bond0 0.0.0.0 up
<span class="anchor" id="line-13-2"></span>        slaves eth4 eth5
<span class="anchor" id="line-14-2"></span># bond-mode 4 = 802.3ad
<span class="anchor" id="line-15-2"></span>        bond-mode 4
<span class="anchor" id="line-16-1"></span>        bond-miimon 100
<span class="anchor" id="line-17-1"></span>        bond-downdelay 200
<span class="anchor" id="line-18-1"></span>        bond-updelay 200
<span class="anchor" id="line-19-1"></span>        bond-lacp-rate 1
<span class="anchor" id="line-20"></span>        bond-xmit-hash-policy layer2+3
<span class="anchor" id="line-21"></span>
<span class="anchor" id="line-22"></span>
<span class="anchor" id="line-23"></span>auto vlan1023
<span class="anchor" id="line-24"></span>iface vlan1023 inet static
<span class="anchor" id="line-25"></span>
<span class="anchor" id="line-26"></span>        address 18.28.4.123
<span class="anchor" id="line-27"></span>        netmask 255.255.255.0
<span class="anchor" id="line-28"></span>        gateway 18.28.4.1
<span class="anchor" id="line-29"></span>        vlan-raw-device bond0
<span class="anchor" id="line-30"></span>
<span class="anchor" id="line-31"></span>
<span class="anchor" id="line-32"></span>auto vlan1024
<span class="anchor" id="line-33"></span>iface vlan1024 inet static
<span class="anchor" id="line-34"></span>
<span class="anchor" id="line-35"></span>        address 10.15.160.1
<span class="anchor" id="line-36"></span>        netmask 255.255.255.0
<span class="anchor" id="line-37"></span>        gateway 10.15.160.100
<span class="anchor" id="line-38"></span>        vlan-raw-device bond0</pre><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><p class="line867">
</p><h2 id="More_information">More information</h2>
<span class="anchor" id="line-281"></span><ul><li><p class="line891"><a class="http" href="http://www.linux.com/feature/133849">http://www.linux.com/feature/133849</a> <span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span></p></li></ul><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-284"></span><a href="https://wiki.debian.org/CategoryNetwork">CategoryNetwork</a>  <span class="anchor" id="line-285"></span><span class="anchor" id="bottom"></span></p></div><div id="pagebottom"></div>
</div>


<div id="footer">
<p id="pageinfo" class="info" lang="en" dir="ltr">BridgeNetworkConnections  (<a class="nbinfo" href="https://wiki.debian.org/BridgeNetworkConnections?action=info" rel="nofollow">last modified 2017-09-22 08:32:26</a>)</p>

<ul id="credits">
<li><a href="https://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="https://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li>Debian Wiki <a href="https://wiki.debian.org/Teams/DebianWiki">team</a>, <a href="https://bugs.debian.org/wiki.debian.org">bugs</a> and <a href="https://git.debian.org/?p=collab-maint/wiki.debian.org.git;a=summary">config</a> available.</li><li>Hosting provided by <a href="https://www.man-da.de/">Metropolitan Area Network Darmstadt</a></li>
</ul>


</div>



</body></html>