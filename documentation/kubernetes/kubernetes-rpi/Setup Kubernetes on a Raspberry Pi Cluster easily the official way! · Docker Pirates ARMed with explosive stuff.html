<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <script src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/cbgapi.loaded_1" async=""></script><script src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/cbgapi.loaded_0" async=""></script><script id="facebook-jssdk" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/sdk.js"></script><script id="twitter-wjs" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/widgets.js"></script><script async="" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/analytics.js"></script><script async="" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/analytics.js"></script><script src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/VCdydsyvKMPYNOUs_NPKOsc8SMg.js"></script><link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Setup Kubernetes on a Raspberry Pi Cluster easily the official way! · Docker Pirates ARMed with explosive stuff </title>

  
  <link rel="stylesheet" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/poole.css">
  <link rel="stylesheet" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/syntax.css">
  <link rel="stylesheet" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/hyde.css">
  <link rel="stylesheet" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/hypriot.css">
  <link rel="stylesheet" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/css.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.hypriot.com/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://blog.hypriot.com/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Docker Pirates ARMed with explosive stuff">
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-59194692-1', 'auto');
    ga('send', 'pageview');

  </script>

<script type="text/javascript" async="" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/embed.js"></script><link rel="prefetch" as="style" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/a_data/lounge.css"><link rel="prefetch" as="script" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/a_data/common.js"><link rel="prefetch" as="script" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/a_data/lounge.js"><link rel="prefetch" as="script" href="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/a_data/config.js"><script type="text/javascript" charset="utf-8" async="" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/button.js"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_loader{background-color:#f6f7f9;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{width:auto;height:auto;min-height:initial;min-width:initial;background:none}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{color:#fff;display:block;padding-top:20px;clear:both;font-size:18px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;bottom:0;left:0;right:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #29487d;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f6f7f9;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-repeat:no-repeat;background-position:50% 50%;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_invisible_flow{display:inherit;height:0;overflow-x:hidden;width:0}.fb_mobile_overlay_active{height:100%;overflow:hidden;position:fixed;width:100%}.fb_shrink_active{opacity:1;transform:scale(1, 1);transition-duration:200ms;transition-timing-function:ease-out}.fb_shrink_active:active{opacity:.5;transform:scale(.75, .75)}</style><script src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/alfalfa.js" async="" charset="UTF-8"></script></head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-logo">
      <a href="https://blog.hypriot.com/"><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/logo_tr.png"></a>
    </div>
    <div class="sidebar-about">
      <h1><a href="https://blog.hypriot.com/">Docker Pirates ARMed with explosive stuff</a></h1>
      <p class="lead">
       Roaming the seven seas in search for golden container plunder. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="https://blog.hypriot.com/">HOME</a> </li>
      
        <li><a href="https://blog.hypriot.com/getting-started-with-docker-on-your-arm-device/"> GETTING STARTED </a></li>
      
        <li><a href="https://blog.hypriot.com/downloads/"> DOWNLOADS </a></li>
      
        <li><a href="https://blog.hypriot.com/faq"> FAQ </a></li>
      
        <li><a href="https://gitter.im/hypriot/talk"> COMMUNITY </a></li>
      
        <li><a href="https://blog.hypriot.com/about"> ABOUT US </a></li>
      
        <li><a href="https://blog.hypriot.com/crew"> CREW </a></li>
      
    </ul>

    <p>© 2017 Hypriot </p>
    <p><a href="https://blog.hypriot.com/legal_notice" style="font-size: 1rem;">Legal Notice</a></p>
    <div class="edit-github" id="edit-github-id">
        <p>
          <a href="https://github.com/hypriot/blog"><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/github-logo.png" style="float:left; width:9%; height:9%; padding-right: 8px; padding-top: 6px; align: center; ">Edit this blog on GitHub</a>
        </p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Setup Kubernetes on a Raspberry Pi Cluster easily the official way!</h1>
    <span class="post-date">Wed, Jan 11, 2017</span>
    <p><a href="https://blog.hypriot.com/post/setup-kubernetes-raspberry-pi-cluster/kubernetes.io">Kubernetes</a> shares the pole position with Docker in the category “orchestration solutions for Raspberry Pi cluster”.
However it’s setup process has been elaborate – until <a href="http://blog.kubernetes.io/2016/09/how-we-made-kubernetes-easy-to-install.html">v1.4 with the kubeadm announcement</a>.
With that effort, Kubernetes changed this game completely and can be up and running officially within no time.</p>

<p>I am very happy to announce that this blog post has been written in collaboration with <a href="https://github.com/luxas">Lucas Käldström</a>, an independent maintainer of Kubernetes (his story is very interesting,  you can read it in a <a href="https://www.cncf.io/blog/2016/11/29/diversity-scholarship-series-programming-journey-becoming-kubernetes-maintainer">CNCF blogpost</a>).</p>

<p><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/raspberry-pi-cluster.png" alt="SwarmClusterHA"></p>

<p></p>

<h2 id="why-kubernetes">Why Kubernetes?</h2>

<p>As shown in my recent <a href="http://www.slideshare.net/MathiasRenner/high-availability-performance-of-kubernetes-and-docker-swarm-on-a-raspberry-pi-cluster/">talk</a>,
 there are many software suites available to manage a cluster of 
computers. There is Kubernetes, Docker Swarm, Mesos, OpenStack, Hadoop 
YARN, Nomad… just to name a few.</p>

<p>However, at Hypriot we have always been in love with tiny devices. So
 when working with an orchestrator, the maximum power we wanna use is 
what’s provided by a Raspberry Pi. Why? We have IoT networks in mind 
that will hold a large share in tomorrow’s IT infrastructure. At their 
edges, the power required for large orchestrators simply is not 
available.</p>

<p>This boundary of resources leads to several requirements that need to
 be checked before we start getting our hands dirty with an 
orchestrator:</p>

<ul>
<li><strong>Lightweight:</strong> Software should be fit on a Raspberry 
Pi or smaller. As proofed in my talk mentioned above, Kubernetes 
painlessly runs on a Raspberry Pi.</li>
<li><strong>ARM compatible:</strong> Since the ARM CPU architecture is 
designed for low energy consumption but still able to deliver a decent 
portion of power, the Raspberry Pi runs an ARM CPU. Thanks to Lucas, 
Kubernetes is ARM compatible.</li>
<li><strong>General purpose:</strong> Hadoop or Apache Spark are great 
for data analysis. But what if your use case changes? We prefer general 
purpose software that allows to run <strong>anything</strong>. 
Kubernetes uses a container runtime (with Docker as the 100% supported 
runtime for the time being) that allows to run whatever you want.</li>
<li><strong>Production ready:</strong> Since we compare Kubernetes 
against a production ready Docker suite, let’s be fair and only choose 
equivalents. Kubernetes itself is production ready, and while the ARM 
port has some small issues, it’s working exactly as expected when going 
the official kubeadm route, which also will mature with time.</li>
</ul>

<p>So, Kubernetes seems to be a compelling competitor to Docker Swarm. Let’s get our hands on it!</p>

<p><br></p>

<h2 id="wait-what-about-kubernetes-on-arm">Wait – what about <em>Kubernetes-on-ARM</em>?</h2>

<p>If you followed the discussion of Kubernetes on ARM for some time, you probably know about Lucas’ project <a href="https://github.com/luxas/kubernetes-on-arm">kubernetes-on-ARM</a>.
 Since the beginning of the movement to bring Kubernetes on ARM in 2015,
 this project has always been the most stable and updated.</p>

<p>However, during 2016, Lucas’ contributions have successfully been 
merged into official Kubernetes repositories, such that there is no 
point any more for using the kubernetes-on-ARM project.
In fact, the features of that project are far behind of what’s now 
implemented in the official repos, <strong>and that has been Lucas’ goal from the beginning.</strong></p>

<p>So if you’re up to using Kubernetes, please stick to the official repos now. And as of the kubeadm documentation, <strong>the following setup is considered official for Kubernetes on ARM.</strong></p>

<p><br></p>

<h2 id="at-first-flash-hypriotos-on-your-sd-cards">At first: Flash HypriotOS on your SD cards</h2>

<p>As hardware, take at least two Raspberry Pis and make sure they are connected to each other and to the Internet.</p>

<p>First, we need an operating system. Download and flash <a href="https://github.com/hypriot/image-builder-rpi/releases">HypriotOS</a>. The fastest way to download and flash HypriotOS on your SD cards is by using our <a href="https://github.com/hypriot/flash">flash tool</a> like so:</p>

<pre><code>flash --hostname node01 <a class="vglnk" href="https://github.com/hypriot/image-builder-rpi/releases/download/v1.4.0/hypriotos-rpi-v1.4.0.img.zip" rel="nofollow"><span>https</span><span>://</span><span>github</span><span>.</span><span>com</span><span>/</span><span>hypriot</span><span>/</span><span>image</span><span>-</span><span>builder</span><span>-</span><span>rpi</span><span>/</span><span>releases</span><span>/</span><span>download</span><span>/</span><span>v1</span><span>.</span><span>4</span><span>.</span><span>0</span><span>/</span><span>hypriotos</span><span>-</span><span>rpi</span><span>-</span><span>v1</span><span>.</span><span>4</span><span>.</span><span>0</span><span>.</span><span>img</span><span>.</span><span>zip</span></a>
</code></pre>

<p>Provision all Raspberry Pis you have like this and boot them up.</p>

<p>Afterwards, SSH into the Raspberry Pis with</p>

<pre><code>ssh pirate@node01.local
</code></pre>

<p>The password <code>hypriot</code> will grant you access.</p>

<p><br></p>

<h2 id="install-kubernetes">Install Kubernetes</h2>

<p>The installation requries root privileges. Retrieve them by</p>

<pre><code>sudo su -
</code></pre>

<p>To install Kubernetes and its dependencies, only some commands are required.
First, trust the kubernetes APT key and add the official APT Kubernetes repository on every node:</p>

<pre><code>$ curl -s <a class="vglnk" href="https://packages.cloud.google.com/apt/doc/apt-key.gpg" rel="nofollow"><span>https</span><span>://</span><span>packages</span><span>.</span><span>cloud</span><span>.</span><span>google</span><span>.</span><span>com</span><span>/</span><span>apt</span><span>/</span><span>doc</span><span>/</span><span>apt</span><span>-</span><span>key</span><span>.</span><span>gpg</span></a> | apt-key add -
$ echo "deb <a class="vglnk" href="http://apt.kubernetes.io/" rel="nofollow"><span>http</span><span>://</span><span>apt</span><span>.</span><span>kubernetes</span><span>.</span><span>io</span><span>/</span></a> kubernetes-xenial main" &gt; /etc/apt/sources.list.d/kubernetes.list
</code></pre>

<p>… and then just install <code>kubeadm</code> on every node:</p>

<pre><code>$ apt-get update &amp;&amp; apt-get install -y kubeadm
</code></pre>

<p>After the previous command has been finished, initialize Kubernetes on the <strong>master node</strong> with</p>

<pre><code>$ kubeadm init --pod-network-cidr 10.244.0.0/16
</code></pre>

<p>It is important that you add the <code>--pod-network-cidr</code> command as given here, because we will use <a href="https://coreos.com/flannel/docs/latest/">flannel</a>. Read the next notes about flannel if you wanna know why.</p>

<blockquote>
<p><strong>Some notes about flannel</strong>: We picked flannel here 
because that’s the only available solution for ARM at the moment (this 
is subject to change in the future though).</p>

<p>flannel can use and is using in this example the Kubernetes API to 
store metadata about the Pod CIDR allocations, and therefore we need to 
tell <em>Kubernetes</em> first which subnet we want to use. The subnet we chose here is somehow fixed, because the <a href="https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml#L25">flannel configuration file</a> that we’ll use later in this guide predefines the equivalent subnet. Of course, you can adapt both.</p>
</blockquote>

<p>If you are connected via WIFI instead of Ethernet, add <code>--apiserver-advertise-address=&lt;wifi-ip-address&gt;</code> as parameter to <code>kubeadm init</code> in order to publish Kubernetes’ API via WiFi. Feel free to explore the other options that exist for <code>kubeadm init</code>.</p>

<p>After Kubernetes has been initialized, the last lines of your terminal should look like this:</p>

<p><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/init.png" alt="init"></p>

<p>To start using your cluster, you need to run (as a regular user):</p>

<pre><code>$ sudo cp /etc/kubernetes/admin.conf $HOME/
$ sudo chown $(id -u):$(id -g) $HOME/admin.conf
$ export KUBECONFIG=$HOME/admin.conf
</code></pre>

<p>Next, as told by that output, let all other nodes join the cluster via the given <code>kubeadm join</code> command. It will look something like:</p>

<pre><code>$ kubeadm join --token=bb14ca.e8bbbedf40c58788 192.168.0.34
</code></pre>

<p>After some seconds, you should see all nodes in your cluster when executing the following <strong>on the master node</strong>:</p>

<pre><code>$ kubectl get nodes
</code></pre>

<p>Your terminal should look like this:</p>

<p><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/get-nodes.png" alt="k8S"></p>

<p>Finally, <strong>we need to setup flannel v0.7.1 as the Pod network driver</strong>. Do not use <a href="https://github.com/coreos/flannel/releases/tag/v0.8.0">v0.8.0</a> due to a known <a href="https://github.com/coreos/flannel/issues/773">bug</a> that can cause a <code>CrashLoopBackOff</code> error. Run this <strong>on the master node</strong>:</p>

<pre><code>$ curl -sSL <a class="vglnk" href="https://rawgit.com/coreos/flannel/v0.7.1/Documentation/kube-flannel-rbac.yml" rel="nofollow"><span>https</span><span>://</span><span>rawgit</span><span>.</span><span>com</span><span>/</span><span>coreos</span><span>/</span><span>flannel</span><span>/</span><span>v0</span><span>.</span><span>7</span><span>.</span><span>1</span><span>/</span><span>Documentation</span><span>/</span><span>kube</span><span>-</span><span>flannel</span><span>-</span><span>rbac</span><span>.</span><span>yml</span></a> | kubectl create -f -
$ curl -sSL <a class="vglnk" href="https://rawgit.com/coreos/flannel/v0.7.1/Documentation/kube-flannel.yml" rel="nofollow"><span>https</span><span>://</span><span>rawgit</span><span>.</span><span>com</span><span>/</span><span>coreos</span><span>/</span><span>flannel</span><span>/</span><span>v0</span><span>.</span><span>7</span><span>.</span><span>1</span><span>/</span><span>Documentation</span><span>/</span><span>kube</span><span>-</span><span>flannel</span><span>.</span><span>yml</span></a> | sed "s/amd64/arm/g" | kubectl create -f -
</code></pre>

<p>Your terminal should look like this:</p>

<p><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/flannel.png" alt="k8S"></p>

<p>Then wait until all flannel and all other cluster-internal Pods are <code>Running</code> before you continue:</p>

<pre><code>$ kubectl get po --all-namespaces
</code></pre>

<p>Nice, it seems like they are all <code>Running</code>:</p>

<p><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/show-namespaces.png" alt="show-namespaces"></p>

<p>That’s all for the setup of Kubernetes! Next, let’s actually spin up a service on the cluster!</p>

<p><br></p>

<h2 id="test-your-setup-with-a-tiny-service">Test your setup with a tiny service</h2>

<p>Let’s start a simple service so see if the cluster actually can publish a service:</p>

<pre><code>$ kubectl run hypriot --image=hypriot/rpi-busybox-httpd --replicas=3 --port=80
</code></pre>

<p>This command starts set of containers called <strong>hypriot</strong> from the image <strong>hypriot/rpi-busybox-httpd</strong> and defines the port the container listens on at <strong>80</strong>. The service will be <strong>replicated with 3 containers</strong>.</p>

<p>Next, expose the Pods in the above created Deployment in a Service with a stable name and IP:</p>

<pre><code>$ kubectl expose deployment hypriot --port 80
</code></pre>

<p>Great! Now, let’s check if all three desired containers are up and running:</p>

<pre><code>$ kubectl get endpoints hypriot
</code></pre>

<p>You should see three endpoints (= containers) like this:</p>

<p><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/show-endpoints.png" alt="show-endpoints"></p>

<p>Let’s curl one of them to see if the service is up:</p>

<p><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/curl-service.png" alt="curl-service"></p>

<p>The HTML is the response of the service. Good, it’s up and running! 
Next, let’s see how we can access it from outside the cluster!</p>

<p><br></p>

<h2 id="finally-access-your-service-from-outside-the-cluster">Finally access your service from outside the cluster</h2>

<p>We will now deploy an example Ingress Controller to manage incoming 
requests from the outside world onto our tiny service. Also, in this 
example we we’ll use <a href="https://traefik.io/">Traefik</a> as load balancer. Read the following notes if you wanna know more about Ingress and Traefik.</p>

<blockquote>
<p><strong>In contrast to Docker Swarm, Kubernetes itself does not 
provide an option to define a specific port that you can use to access a
 service</strong>. According to Lucas this is an important design 
decision; routing of incoming requests should be handled by a third 
party, such as a load balancer or a webserver, but not by the core 
product. The core Kubernetes should be lean and extensible, and 
encourage others to build tools on top of it for their specific needs.</p>

<p>Regarding load balancers in front of a cluster, there is <a href="http://kubernetes.io/docs/user-guide/ingress/">the Ingress API object</a> and some sample <a href="https://github.com/kubernetes/ingress">Ingress Controllers</a>. Ingress is a built-in way of exposing Services to the outside world via an Ingress Controller that anyone can build. An <em>Ingress rule</em> defines how traffic should flow from the node the Ingress controller runs on to services inside of the cluster.</p>
</blockquote>

<p>First, let’s deploy traefik as load balancer:</p>

<pre><code>$ kubectl apply -f <a class="vglnk" href="https://raw.githubusercontent.com/hypriot/rpi-traefik/master/traefik-k8s-example.yaml" rel="nofollow"><span>https</span><span>://</span><span>raw</span><span>.</span><span>githubusercontent</span><span>.</span><span>com</span><span>/</span><span>hypriot</span><span>/</span><span>rpi</span><span>-</span><span>traefik</span><span>/</span><span>master</span><span>/</span><span>traefik</span><span>-</span><span>k8s</span><span>-</span><span>example</span><span>.</span><span>yaml</span></a>
</code></pre>

<p>Label the node you want to be the load balancer. Then the Traefik Ingress Controller will land on the node you specified. Run:</p>

<pre><code>$ kubectl label node &lt;load balancer-node&gt; nginx-controller=traefik
</code></pre>

<p>Lastly, create an Ingress object that makes Traefik load balance traffic on port <code>80</code> to the <code>hypriot</code> service:</p>

<pre><code>$ cat &gt; hypriot-ingress.yaml &lt;&lt;EOF
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: hypriot
spec:
  rules:
  - http:
      paths:
      - path: /
        backend:
          serviceName: hypriot
          servicePort: 80
EOF
$ kubectl apply -f hypriot-ingress.yaml
</code></pre>

<p>Visit the loadbalancing node’s IP address in your browser and you should see a nice web page:</p>

<p><img src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/hypriot-website.png" alt="curl-service"></p>

<p>If you don’t see a website there yet, run:</p>

<pre><code>$ kubectl get pods
</code></pre>

<p>… and make sure all hypriot Pods are in the <code>Running</code> state.</p>

<p>Wait until you see that all Pods are running, and a nice Hypriot website should appear!</p>

<p><br></p>

<h2 id="tear-down-the-cluster">Tear down the cluster</h2>

<p>If you wanna reset the whole cluster to the state after a fresh install, just run this on each node:</p>

<pre><code>$ kubeadm reset
</code></pre>

<p>In addition, it is recommended to delete some additional files <a href="https://stackoverflow.com/questions/41359224/kubernetes-failed-to-setup-network-for-pod-after-executed-kubeadm-reset/41372829#41372829">as it is mentioned here</a>.</p>

<p><br></p>

<h2 id="optional-deploy-the-kubernetes-dashboard">Optional: Deploy the Kubernetes dashboard</h2>

<p>The dashboard is a wonderful interface to visualize the state of the cluster. Start it with:</p>

<pre><code>$ curl -sSL <a class="vglnk" href="https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml" rel="nofollow"><span>https</span><span>://</span><span>rawgit</span><span>.</span><span>com</span><span>/</span><span>kubernetes</span><span>/</span><span>dashboard</span><span>/</span><span>master</span><span>/</span><span>src</span><span>/</span><span>deploy</span><span>/</span><span>kubernetes</span><span>-</span><span>dashboard</span><span>.</span><span>yaml</span></a> | sed "s/amd64/arm/g" | kubectl create -f -
</code></pre>

<p>The following command provides the port that the dashboard is exposed
 at on every node with the NodePort function of Services, which is 
another way to expose your Services to the outside of your cluster:</p>

<pre><code>$ kubectl -n kube-system get service kubernetes-dashboard -o 
template --template="{{ (index .spec.ports 0).nodePort }}" | xargs echo
</code></pre>

<p>Then you can checkout the dashboard on any node’s IP address on that port!</p>

<p><br></p>

<h2 id="you-like-a-follow-up">You like a follow-up?</h2>

<p>It was our goal to show that Kubernetes indeed works well on ARM (and
 ARM 64-bit!). For more examples including the AMD64 platform, check out
 the <a href="http://kubernetes.io/docs/getting-started-guides/kubeadm/">official kubeadm documentation</a>.</p>

<p>We might follow-up this blog post with a more in-depth post about the
 current and planned state of Kubernetes officially on ARM and more, so 
stay tuned and tell Lucas if that’s something you’re interested in 
reading.</p>

<p>As always, use the comments below to give us feedback and share this post on Twitter, Google or Facebook.</p>

<p><a href="https://twitter.com/MathiasRenner">Mathias Renner</a> and <a href="https://twitter.com/kubernetesonarm">Lucas Käldström</a></p>
    <div class="social-sharing">
  
<div class="social-sharing-twitter" style="float: left;">
  <iframe id="twitter-widget-0" scrolling="no" allowtransparency="true" class="twitter-share-button twitter-share-button-rendered twitter-tweet-button" style="position: static; visibility: visible; width: 61px; height: 20px;" title="Twitter Tweet Button" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/tweet_button.html" data-url="https://blog.hypriot.com/post/setup-kubernetes-raspberry-pi-cluster/" frameborder="0"></iframe>
  <script src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/email-decode.js"></script><script>
  window.twttr=(function(d,s,id){var 
js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return
 t;}(document,"script","twitter-wjs"));
  </script>
</div>

  
<div class="social-sharing-facebook" style="float: left;">
  <div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_https" allowtransparency="true" allowfullscreen="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" style="border: medium none;" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/lY4eZXm_YWu.html" frameborder="0"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.5&appId=599115553447708";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>
  <div class="fb-share-button fb_iframe_widget" data-href="https://blog.hypriot.com/post/setup-kubernetes-raspberry-pi-cluster/" data-layout="button_count" fb-xfbml-state="rendered" fb-iframe-plugin-query="app_id=599115553447708&amp;container_width=10&amp;href=https%3A%2F%2Fblog.hypriot.com%2Fpost%2Fsetup-kubernetes-raspberry-pi-cluster%2F&amp;layout=button_count&amp;locale=en_GB&amp;sdk=joey"><span style="vertical-align: bottom; width: 74px; height: 20px;"><iframe name="f96e143307404a" allowtransparency="true" allowfullscreen="true" scrolling="no" title="fb:share_button Facebook Social Plugin" style="border: medium none; visibility: visible; width: 74px; height: 20px;" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/share_button.html" class="" width="1000px" height="1000px" frameborder="0"></iframe></span></div>
</div>

  
<div class="social-sharing-google">
  <script>
    window.___gcfg = {
      lang: 'en-US',
      parsetags: 'onload'
    };
  </script>
  <script src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/platform.js" async="" defer="defer" gapi_processed="true"></script>
  <div style="text-indent: 0px; margin: 0px; padding: 0px; background: transparent none repeat scroll 0% 0%; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 200px; height: 20px;" id="___plus_0"><iframe ng-non-bindable="" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 200px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" tabindex="0" vspace="0" id="I0_1511271677542" name="I0_1511271677542" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/sharebutton.html" data-gapiattached="true" title="G+" width="100%" frameborder="0"></iframe></div>
</div>

</div>

    <div id="disqus_thread"><iframe id="dsq-app2785" name="dsq-app2785" allowtransparency="true" scrolling="no" tabindex="0" title="Disqus" style="width: 1px !important; min-width: 100% !important; border: medium none !important; overflow: hidden !important; height: 10742px !important;" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/a.html" horizontalscrolling="no" verticalscrolling="no" width="100%" frameborder="0"></iframe></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'hypriot';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="<a class="vglnk" href="http://disqus.com/?ref_noscript" rel="nofollow"><span>http</span><span>://</span><span>disqus</span><span>.</span><span>com</span><span>/?</span><span>ref</span><span>_</span><span>noscript</span></a>">comments powered by Disqus.</a></noscript>


  </div>
</div>



<iframe style="display: none;"></iframe><iframe name="oauth2relay492519754" id="oauth2relay492519754" src="Setup%20Kubernetes%20on%20a%20Raspberry%20Pi%20Cluster%20easily%20the%20official%20way!%20%C2%B7%20Docker%20Pirates%20ARMed%20with%20explosive%20stuff_files/postmessageRelay.html" style="width: 1px; height: 1px; position: absolute; top: -100px;" tabindex="-1" aria-hidden="true"></iframe></body></html>